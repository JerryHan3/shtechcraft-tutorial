# 新人入门
> 本文档适用于：SHTechCraft 运维组

本文档默认你已经有以下基础知识：
- 流畅的英语阅读能力。大部分有效的计算机技术文档都是英语，你应该尽量适应之
- linux 的基础操作。你可以在[计算机教育中缺失的一课](https://missing-semester-cn.github.io/)的前五章中学到相关技能
- 运行一个 MC 服务器。你可以在[Tutorial: Setting up a Java Edition server](https://minecraft.wiki/w/Tutorial:Setting_up_a_Java_Edition_server)找到教程

如果你对以上内容感到陌生，你可以在[小白入门](小白入门.md)中，找到极简教程。但是，《小白入门》仅仅只是帮你补足本文档所需的最基本的前置知识，你不应该仅依靠此文档，不应依靠一个知识的二道贩子。

### 直接开服的局限性
直接在机器上，通过 `java server.jar` 运行一个 MC 服固然方便，但是：

**1**. 我的机器需要开多个 MC 服。而它们需要不同的 java 版本
  - 你当然可以在你的机器上安装多个 java 版本。但是你不得不单独为每个 MC 服指定其所使用的 java 版本。而你很容易遗漏每个 java 版本需要配置的环境变量

**2**. 我想要迁移 MC 服到新的机器上
  - 你需要记住你的服务器需要备份哪些东西，容易遗漏

**3**. 我想要限制 MC 服占用的资源
  - 你可以设置 java 虚拟机参数。但是你如何限制它所使用的 cpu 核心数？

**4**. 我需要能够自动重新启动的 MC 服
  - 通过 shell 脚本，你可以配置当 MC 服崩溃以后自动重启。但如果你需要定期自动重启，以回收内存呢？你如何去配置一个定时任务？
  - 定时重启的需求，是源于 MC 服内存泄露的问题，即随着时间的推移，MC 服占用的内存会越来越大

### Docker
> 你可以在[这里](https://docs.docker.com/get-started/)找到 Docker 的基础教程
>
> 通过阅读链接中的文档，你需要达到以下能力
> - 理解镜像与容器是什么含义
> - 理解为什么 docker 可以较好地解决局限性 1, 2, 3
> - 配置 docker 使用的代理，或者更改一个国内可以访问的 docker 镜像源
> - 运行 hello-world 镜像
> - 写一个 dockerfile，使它能够创建一个 MC 服镜像。运行这个镜像后，你可以登进去这个 MC 服
> - 了解端口转发、挂载卷是什么含义，如何操作

SHTechCraft 使用 docker 将 MC 服封装为镜像，并从这个镜像中运行 MC 服容器。在配置 dockerfile 时，需要考虑以下因素：
- 无论是原版 MC 服务端，还是各种魔改服务端，它们几乎都不包含运行时的所有文件。因此，你在配置镜像时，需要考虑如何处理运行一次服务端以后才产生的文件
- MC 服既存在像 config、libraries 这样，在游玩过程中几乎不会变化的目录，也存在像 world 这样，随着游玩进程不断变化的目录，还有 plugins 这种可能会随时调整的目录。你应该如何取舍需要挂载的目录？特别的，考虑到服务器更新、迁移的便捷性，你又应该如何取舍挂载目录？
- 考虑到可复现性，你应尽量使用 dockerfile 一次性创建镜像，而不是保存一个修修补补的容器为镜像
- 如果你仅使用 docker 来运行 MC 服，考虑到便捷性，你应该尽量将默认配置写入 dockerfile。即你可以直接使用`docker run shtechcraft:latest`来运行，无需添加更多的参数。然而，在后文的 k8s 介绍中，你可以**忽略**此条。因为 k8s 的相关文件中也提供了类似的配置选项

你可以参考 SHTechCraft 四周目服的仓库（在本仓库的 mc-leaves-serverpack submodule 中），以配置 dockerfile。不过这个仓库些许违反了可复现性。

### Kubernetes (K8s)
> Kubernetes 通常缩写为 K8s，因为 "K" 与 "s" 之中间隔了 8 个字母。与之类似的还有 internationalization，其缩写为 i18n
>
> 你可以在[这里](https://kubernetes.io/zh-cn/docs/home/)找到 K8s 的教程
>
> 通过阅读链接中的文档，你需要达到以下能力
> - 理解 K8s 集群的架构，即文档中 “Kubernetes 架构” 一节所描述的各个元素与层次
> - 理解 K8s 为什么可以解决局限性 4，以及 Docker 一节所提到的“忽略”便捷性
> - 能够运行教程中的示例 Job，然后停止它
> - 为 MC 服写一个 Job yaml，要求能挂载应该挂载的目录，转发服务器端口。然后运行它

SHTechCraft 使用 K8s 来管理 MC 服的运行。在配置 Job yaml 时，需要考虑以下因素：
- Docker 一节提到过的挂载目录
- Docker 一节提到过的默认配置
- 如果镜像的默认入口命令是直接启动 MC 服，那 Job 天然支持崩服以后自动重启

实际上， K8s 的能力远不止以上内容。目前 SHTechCraft 正计划部署小游戏群组服。它支持根据需求，自动启动/回收小游戏子服